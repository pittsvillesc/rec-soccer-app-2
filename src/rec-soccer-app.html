<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-icons/communication-icons.html">
<link rel="import" href="../bower_components/iron-icons/places-icons.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/login-fire/login-fire.html">
<link rel="import" href="shared-styles.html">
<!--<link rel="import" href="my-icons.html">-->

<dom-module id="rec-soccer-app">
    <template>
    <style include="shared-styles">
         :host {
            --app-primary-color: #5E8C9C;
            --app-secondary-color: black;
            --app-drawer-content-container: { background-color: #F7F7F7; }     
            display: block;
        }
        
        app-header {
            color: #fff;
            height: 40px;
            background-color: var(--app-primary-color);
            padding: 5px;
        }

        app-header paper-icon-button {
            --paper-icon-button-ink-color: white;
        }        
        #drawer app-toolbar {
            background-color: #547E8C;
            color: #fff;
            height: 40px;
            padding: 5px;
        }
        .drawer-list {
            margin: 0 20px;
        }

        .drawer-list a {
            display: block;
            padding: 0 16px;
            text-decoration: none;
            color: var(--app-secondary-color);
            line-height: 40px;
            @apply(--layout-horizontal);
        }
        .drawer-list a iron-icon {
            --iron-icon-height: 18px;
            --iron-icon-width: 18px;
            padding-right: 8px;
        }

        .drawer-list a.iron-selected {
            color: black;
            font-weight: bold;
        }
        #main-title {
/*            font-size: 20px;*/
        }
        login-fire { 
            position: absolute;
/*            opacity: 1;*/
                top: 50px;
                left: 0;
                right: 0;
                bottom: 0;
/*                background-color: @apply(--app-primary-color);*/
                transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                z-index: 1;
                color: var(--sign-in-text-color, rgb(255, 255, 255));
                @apply(--layout);
                @apply(--layout-center-center);
        }
        
        login-fire([signed-in]) {
            opacity: 0;
            pointer-events: none;
        }
        .link-text {
            @apply(--layout-flex);
        }
        .link-qty {
            font-size: 12px;
        }
    </style>
    
    
    <app-location route="{{route}}"></app-location>
    <app-route route="{{route}}" 
               pattern="/:page"
               data="{{routeData}}"
               tail="{{subroute}}"></app-route>

    <app-drawer-layout fullbleed>
        
        <!-- Drawer content -->
        <app-drawer id="drawer">
            <app-toolbar>Menu</app-toolbar>
            <iron-selector selected="[[page]]" 
                           attr-for-selected="name" 
                           class="drawer-list" 
                           role="navigation">
                <div hidden$="[[signedIn]]">
                    <a name="contacts"
                       href="/contacts"><iron-icon icon="lock"></iron-icon>Sign In</a>
                </div>
                <div hidden$="[[!signedIn]]">                    
                    <a name="contacts" 
                       href="/contacts">
                        <div class="link-icon">
                            <iron-icon icon="communication:contacts"></iron-icon>
                        </div>
                        <div class="link-text">
                            Family
                        </div>
                        <div class="link-qty">
                            1
                        </div>
                    </a>
                    <a name="players" 
                       href="/players">
                        <div class="link-icon">
                            <iron-icon icon="places:child-care"></iron-icon>
                        </div>
                        <div class="link-text">
                            Players
                        </div>
                        <div class="link-qty"></div>
                    </a>
                    <a name="registration" 
                       href="/registration">
                        <div class="link-icon">
                            <iron-icon icon="assignment"></iron-icon>
                        </div>
                        <div class="link-text">
                            Registration
                        </div>
                        <div class="link-qty"></div>
                    </a>
                </div>
            </iron-selector>
        </app-drawer>
        
        <!-- Main content -->
        <app-header-layout has-scrolling-region>

            <app-header condenses 
                        reveals 
                        effects="waterfall">
                <app-toolbar>
                    <paper-icon-button icon="my-icons:menu" 
                                       drawer-toggle></paper-icon-button>
                    <div>[[header]]</div>
                </app-toolbar>
            </app-header>
            <div hidden$="[[signedIn]]">
            <firebase-app id="regApp" 
                          auth-domain="registration-app-a043a.firebaseapp.com" 
                          database-url="https://registration-app-a043a.firebaseio.com/" 
                          api-key="AIzaSyCb-qKlzvWaz6gwyURFilfpCr1HUbnZCN8" 
                          name="registration-app"></firebase-app>
            <login-fire horizontal 
                    email-password 
                    google
                    app-name="registration-app"
                    user="{{user}}"
                    signed-in="{{signedIn}}"
                    debug></login-fire>
                
            </div>
            <div hidden$="[[!signedIn]]">
            <iron-pages selected="[[page]]" 
                        attr-for-selected="name" 
                        fallback-selection="view404" 
                        role="main">
                
                
                <rec-soccer-contacts name="contacts"
                                     class="list-container"class="list-container"
                                     user="[[user]]"
                                     data="{{contactData}}">
                    <firebase-query id="contactQuery" 
                                    app-name="registration-app" 
                                    path="/family-profile/[[user.uid]]/family-contacts" 
                                    data="{{contactData}}"></firebase-query>
                </rec-soccer-contacts>
                <rec-soccer-players name="players"
                                    class="list-container">
                    <firebase-query id="playerQuery" 
                                    app-name="registration-app" 
                                    path="/family-profile/[[user.uid]]/player-profile" 
                                    data="{{playerData}}"></firebase-query>
                </rec-soccer-players>
                <rec-soccer-registration name="registration"
                                         class="list-container"></rec-soccer-registration>
                <rec-soccer-view404 name="view404"
                                    class="list-container"></rec-soccer-view404>
                
            </iron-pages>
            </div>
        </app-header-layout>
    </app-drawer-layout>
</template>

    <script>
        Polymer({
            is: 'rec-soccer-app',

            properties: {
                page: {
                    type: String,
                    reflectToAttribute: true,
                    observer: '_pageChanged',
                },
                user: {
                    type: String,
                    reflectToAttribute: true,
                    notify: true
                },
                signedIn: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true              
                },
                header: {
                    type: String,
                    notify: true,                    
                },
//                contactData: {
//                    type: Array
//                }
                
            },            

            observers: [
                '_routePageChanged(routeData.page)',
            ],
            
            listeners: {
                "showData": "showData"
            },

            _routePageChanged: function(page) {
                this.page = page || 'contacts';
                
                if (!this.$.drawer.persistent) {
                    this.$.drawer.close();
                }
                
                switch(page) {
                    case "contacts":
                        this.header = "Family Contacts (Parents/Guardians)";
                        break;
                    case "players":
                        this.header = "Rec Soccer Players";
                        break;
                    case "registration":
                        this.header = "Current Season Registration";
                        break;
                }
            },

            _pageChanged: function(page) {
                // Load page import on demand. Show 404 page if fails
                var resolvedPageUrl = this.resolveUrl('rec-soccer-' + page + '.html');
                this.importHref(resolvedPageUrl, null, this._showPage404, true);
            },

            _showPage404: function() {
                this.page = 'view404';
            },
                showData: function() {
                     console.info("contactQuery Data:", this.$.contactQuery.data);
                console.info("contactQuery Ref:", this.$.contactQuery);
                console.info("contactQuery Path:", this.$.contactQuery.path);
                }
        });

    </script>
</dom-module>
